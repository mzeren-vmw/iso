<!DOCTYPE html>
<html>
  <head>
      <meta charset="utf-8" />
      <title>sketch</title>
      <style>.markdown-preview:not([data-use-github-style]) { padding: 2em; font-size: 1.2em; color: rgb(171, 178, 191); overflow: auto; background-color: rgb(40, 44, 52); }
.markdown-preview:not([data-use-github-style]) > :first-child { margin-top: 0px; }
.markdown-preview:not([data-use-github-style]) h1, .markdown-preview:not([data-use-github-style]) h2, .markdown-preview:not([data-use-github-style]) h3, .markdown-preview:not([data-use-github-style]) h4, .markdown-preview:not([data-use-github-style]) h5, .markdown-preview:not([data-use-github-style]) h6 { line-height: 1.2; margin-top: 1.5em; margin-bottom: 0.5em; color: rgb(255, 255, 255); }
.markdown-preview:not([data-use-github-style]) h1 { font-size: 2.4em; font-weight: 300; }
.markdown-preview:not([data-use-github-style]) h2 { font-size: 1.8em; font-weight: 400; }
.markdown-preview:not([data-use-github-style]) h3 { font-size: 1.5em; font-weight: 500; }
.markdown-preview:not([data-use-github-style]) h4 { font-size: 1.2em; font-weight: 600; }
.markdown-preview:not([data-use-github-style]) h5 { font-size: 1.1em; font-weight: 600; }
.markdown-preview:not([data-use-github-style]) h6 { font-size: 1em; font-weight: 600; }
.markdown-preview:not([data-use-github-style]) strong { color: rgb(255, 255, 255); }
.markdown-preview:not([data-use-github-style]) del { color: rgb(124, 135, 156); }
.markdown-preview:not([data-use-github-style]) a, .markdown-preview:not([data-use-github-style]) a code { color: rgb(82, 139, 255); }
.markdown-preview:not([data-use-github-style]) img { max-width: 100%; }
.markdown-preview:not([data-use-github-style]) > p { margin-top: 0px; margin-bottom: 1.5em; }
.markdown-preview:not([data-use-github-style]) > ul, .markdown-preview:not([data-use-github-style]) > ol { margin-bottom: 1.5em; }
.markdown-preview:not([data-use-github-style]) blockquote { margin: 1.5em 0px; font-size: inherit; color: rgb(124, 135, 156); border-color: rgb(75, 83, 98); border-width: 4px; }
.markdown-preview:not([data-use-github-style]) hr { margin: 3em 0px; border-top: 2px dashed rgb(75, 83, 98); background: none; }
.markdown-preview:not([data-use-github-style]) table { margin: 1.5em 0px; }
.markdown-preview:not([data-use-github-style]) th { color: rgb(255, 255, 255); }
.markdown-preview:not([data-use-github-style]) th, .markdown-preview:not([data-use-github-style]) td { padding: 0.66em 1em; border: 1px solid rgb(75, 83, 98); }
.markdown-preview:not([data-use-github-style]) pre, .markdown-preview:not([data-use-github-style]) code { color: rgb(255, 255, 255); background-color: rgb(58, 63, 75); }
.markdown-preview:not([data-use-github-style]) pre, .markdown-preview:not([data-use-github-style]) pre.editor-colors { margin: 1.5em 0px; padding: 1em; font-size: 0.92em; border-radius: 3px; background-color: rgb(49, 54, 63); }
.markdown-preview:not([data-use-github-style]) kbd { color: rgb(255, 255, 255); border-width: 1px 1px 2px; border-style: solid; border-color: rgb(75, 83, 98) rgb(75, 83, 98) rgb(62, 68, 81); background-color: rgb(58, 63, 75); }
.markdown-preview[data-use-github-style] { font-family: "Helvetica Neue", Helvetica, "Segoe UI", Arial, freesans, sans-serif; line-height: 1.6; word-wrap: break-word; padding: 30px; font-size: 16px; color: rgb(51, 51, 51); overflow: scroll; background-color: rgb(255, 255, 255); }
.markdown-preview[data-use-github-style] > :first-child { margin-top: 0px !important; }
.markdown-preview[data-use-github-style] > :last-child { margin-bottom: 0px !important; }
.markdown-preview[data-use-github-style] a:not([href]) { color: inherit; text-decoration: none; }
.markdown-preview[data-use-github-style] .absent { color: rgb(204, 0, 0); }
.markdown-preview[data-use-github-style] .anchor { position: absolute; top: 0px; left: 0px; display: block; padding-right: 6px; padding-left: 30px; margin-left: -30px; }
.markdown-preview[data-use-github-style] .anchor:focus { outline: none; }
.markdown-preview[data-use-github-style] h1, .markdown-preview[data-use-github-style] h2, .markdown-preview[data-use-github-style] h3, .markdown-preview[data-use-github-style] h4, .markdown-preview[data-use-github-style] h5, .markdown-preview[data-use-github-style] h6 { position: relative; margin-top: 1em; margin-bottom: 16px; font-weight: bold; line-height: 1.4; }
.markdown-preview[data-use-github-style] h1 .octicon-link, .markdown-preview[data-use-github-style] h2 .octicon-link, .markdown-preview[data-use-github-style] h3 .octicon-link, .markdown-preview[data-use-github-style] h4 .octicon-link, .markdown-preview[data-use-github-style] h5 .octicon-link, .markdown-preview[data-use-github-style] h6 .octicon-link { display: none; color: rgb(0, 0, 0); vertical-align: middle; }
.markdown-preview[data-use-github-style] h1:hover .anchor, .markdown-preview[data-use-github-style] h2:hover .anchor, .markdown-preview[data-use-github-style] h3:hover .anchor, .markdown-preview[data-use-github-style] h4:hover .anchor, .markdown-preview[data-use-github-style] h5:hover .anchor, .markdown-preview[data-use-github-style] h6:hover .anchor { padding-left: 8px; margin-left: -30px; text-decoration: none; }
.markdown-preview[data-use-github-style] h1:hover .anchor .octicon-link, .markdown-preview[data-use-github-style] h2:hover .anchor .octicon-link, .markdown-preview[data-use-github-style] h3:hover .anchor .octicon-link, .markdown-preview[data-use-github-style] h4:hover .anchor .octicon-link, .markdown-preview[data-use-github-style] h5:hover .anchor .octicon-link, .markdown-preview[data-use-github-style] h6:hover .anchor .octicon-link { display: inline-block; }
.markdown-preview[data-use-github-style] h1 tt, .markdown-preview[data-use-github-style] h2 tt, .markdown-preview[data-use-github-style] h3 tt, .markdown-preview[data-use-github-style] h4 tt, .markdown-preview[data-use-github-style] h5 tt, .markdown-preview[data-use-github-style] h6 tt, .markdown-preview[data-use-github-style] h1 code, .markdown-preview[data-use-github-style] h2 code, .markdown-preview[data-use-github-style] h3 code, .markdown-preview[data-use-github-style] h4 code, .markdown-preview[data-use-github-style] h5 code, .markdown-preview[data-use-github-style] h6 code { font-size: inherit; }
.markdown-preview[data-use-github-style] h1 { padding-bottom: 0.3em; font-size: 2.25em; line-height: 1.2; border-bottom: 1px solid rgb(238, 238, 238); }
.markdown-preview[data-use-github-style] h1 .anchor { line-height: 1; }
.markdown-preview[data-use-github-style] h2 { padding-bottom: 0.3em; font-size: 1.75em; line-height: 1.225; border-bottom: 1px solid rgb(238, 238, 238); }
.markdown-preview[data-use-github-style] h2 .anchor { line-height: 1; }
.markdown-preview[data-use-github-style] h3 { font-size: 1.5em; line-height: 1.43; }
.markdown-preview[data-use-github-style] h3 .anchor { line-height: 1.2; }
.markdown-preview[data-use-github-style] h4 { font-size: 1.25em; }
.markdown-preview[data-use-github-style] h4 .anchor { line-height: 1.2; }
.markdown-preview[data-use-github-style] h5 { font-size: 1em; }
.markdown-preview[data-use-github-style] h5 .anchor { line-height: 1.1; }
.markdown-preview[data-use-github-style] h6 { font-size: 1em; color: rgb(119, 119, 119); }
.markdown-preview[data-use-github-style] h6 .anchor { line-height: 1.1; }
.markdown-preview[data-use-github-style] p, .markdown-preview[data-use-github-style] blockquote, .markdown-preview[data-use-github-style] ul, .markdown-preview[data-use-github-style] ol, .markdown-preview[data-use-github-style] dl, .markdown-preview[data-use-github-style] table, .markdown-preview[data-use-github-style] pre { margin-top: 0px; margin-bottom: 16px; }
.markdown-preview[data-use-github-style] hr { height: 4px; padding: 0px; margin: 16px 0px; border: 0px none; background-color: rgb(231, 231, 231); }
.markdown-preview[data-use-github-style] ul, .markdown-preview[data-use-github-style] ol { padding-left: 2em; }
.markdown-preview[data-use-github-style] ul.no-list, .markdown-preview[data-use-github-style] ol.no-list { padding: 0px; list-style-type: none; }
.markdown-preview[data-use-github-style] ul ul, .markdown-preview[data-use-github-style] ul ol, .markdown-preview[data-use-github-style] ol ol, .markdown-preview[data-use-github-style] ol ul { margin-top: 0px; margin-bottom: 0px; }
.markdown-preview[data-use-github-style] li > p { margin-top: 16px; }
.markdown-preview[data-use-github-style] dl { padding: 0px; }
.markdown-preview[data-use-github-style] dl dt { padding: 0px; margin-top: 16px; font-size: 1em; font-style: italic; font-weight: bold; }
.markdown-preview[data-use-github-style] dl dd { padding: 0px 16px; margin-bottom: 16px; }
.markdown-preview[data-use-github-style] blockquote { padding: 0px 15px; color: rgb(119, 119, 119); border-left: 4px solid rgb(221, 221, 221); }
.markdown-preview[data-use-github-style] blockquote > :first-child { margin-top: 0px; }
.markdown-preview[data-use-github-style] blockquote > :last-child { margin-bottom: 0px; }
.markdown-preview[data-use-github-style] table { display: block; width: 100%; overflow: auto; word-break: keep-all; }
.markdown-preview[data-use-github-style] table th { font-weight: bold; }
.markdown-preview[data-use-github-style] table th, .markdown-preview[data-use-github-style] table td { padding: 6px 13px; border: 1px solid rgb(221, 221, 221); }
.markdown-preview[data-use-github-style] table tr { border-top: 1px solid rgb(204, 204, 204); background-color: rgb(255, 255, 255); }
.markdown-preview[data-use-github-style] table tr:nth-child(2n) { background-color: rgb(248, 248, 248); }
.markdown-preview[data-use-github-style] img { max-width: 100%; box-sizing: border-box; }
.markdown-preview[data-use-github-style] .emoji { max-width: none; }
.markdown-preview[data-use-github-style] span.frame { display: block; overflow: hidden; }
.markdown-preview[data-use-github-style] span.frame > span { display: block; float: left; width: auto; padding: 7px; margin: 13px 0px 0px; overflow: hidden; border: 1px solid rgb(221, 221, 221); }
.markdown-preview[data-use-github-style] span.frame span img { display: block; float: left; }
.markdown-preview[data-use-github-style] span.frame span span { display: block; padding: 5px 0px 0px; clear: both; color: rgb(51, 51, 51); }
.markdown-preview[data-use-github-style] span.align-center { display: block; overflow: hidden; clear: both; }
.markdown-preview[data-use-github-style] span.align-center > span { display: block; margin: 13px auto 0px; overflow: hidden; text-align: center; }
.markdown-preview[data-use-github-style] span.align-center span img { margin: 0px auto; text-align: center; }
.markdown-preview[data-use-github-style] span.align-right { display: block; overflow: hidden; clear: both; }
.markdown-preview[data-use-github-style] span.align-right > span { display: block; margin: 13px 0px 0px; overflow: hidden; text-align: right; }
.markdown-preview[data-use-github-style] span.align-right span img { margin: 0px; text-align: right; }
.markdown-preview[data-use-github-style] span.float-left { display: block; float: left; margin-right: 13px; overflow: hidden; }
.markdown-preview[data-use-github-style] span.float-left span { margin: 13px 0px 0px; }
.markdown-preview[data-use-github-style] span.float-right { display: block; float: right; margin-left: 13px; overflow: hidden; }
.markdown-preview[data-use-github-style] span.float-right > span { display: block; margin: 13px auto 0px; overflow: hidden; text-align: right; }
.markdown-preview[data-use-github-style] code, .markdown-preview[data-use-github-style] tt { padding: 0.2em 0px; margin: 0px; font-size: 85%; border-radius: 3px; background-color: rgba(0, 0, 0, 0.0392157); }
.markdown-preview[data-use-github-style] code::before, .markdown-preview[data-use-github-style] tt::before, .markdown-preview[data-use-github-style] code::after, .markdown-preview[data-use-github-style] tt::after { letter-spacing: -0.2em; content: " "; }
.markdown-preview[data-use-github-style] code br, .markdown-preview[data-use-github-style] tt br { display: none; }
.markdown-preview[data-use-github-style] del code { text-decoration: inherit; }
.markdown-preview[data-use-github-style] pre > code { padding: 0px; margin: 0px; font-size: 100%; word-break: normal; white-space: pre; border: 0px; background: transparent; }
.markdown-preview[data-use-github-style] .highlight { margin-bottom: 16px; }
.markdown-preview[data-use-github-style] .highlight pre, .markdown-preview[data-use-github-style] pre { padding: 16px; overflow: auto; font-size: 85%; line-height: 1.45; border-radius: 3px; background-color: rgb(247, 247, 247); }
.markdown-preview[data-use-github-style] .highlight pre { margin-bottom: 0px; word-break: normal; }
.markdown-preview[data-use-github-style] pre { word-wrap: normal; }
.markdown-preview[data-use-github-style] pre code, .markdown-preview[data-use-github-style] pre tt { display: inline; max-width: initial; padding: 0px; margin: 0px; overflow: initial; line-height: inherit; word-wrap: normal; border: 0px; background-color: transparent; }
.markdown-preview[data-use-github-style] pre code::before, .markdown-preview[data-use-github-style] pre tt::before, .markdown-preview[data-use-github-style] pre code::after, .markdown-preview[data-use-github-style] pre tt::after { content: normal; }
.markdown-preview[data-use-github-style] kbd { display: inline-block; padding: 3px 5px; font-size: 11px; line-height: 10px; color: rgb(85, 85, 85); vertical-align: middle; border-width: 1px; border-style: solid; border-color: rgb(204, 204, 204) rgb(204, 204, 204) rgb(187, 187, 187); border-radius: 3px; box-shadow: rgb(187, 187, 187) 0px -1px 0px inset; background-color: rgb(252, 252, 252); }
.markdown-preview[data-use-github-style] a { color: rgb(51, 122, 183); }
.markdown-preview[data-use-github-style] pre, .markdown-preview[data-use-github-style] code { color: inherit; }
.markdown-preview[data-use-github-style] pre, .markdown-preview[data-use-github-style] pre.editor-colors { padding: 0.8em 1em; margin-bottom: 1em; font-size: 0.85em; border-radius: 4px; overflow: auto; }
.scrollbars-visible-always .markdown-preview pre.editor-colors.editor .vertical-scrollbar, .scrollbars-visible-always .markdown-preview pre.editor-colors.editor .horizontal-scrollbar { visibility: hidden; }
.scrollbars-visible-always .markdown-preview pre.editor-colors:hover.editor .vertical-scrollbar, .scrollbars-visible-always .markdown-preview pre.editor-colors:hover.editor .horizontal-scrollbar { visibility: visible; }
.markdown-preview del { text-decoration: none; position: relative; }
.markdown-preview del::after { border-bottom: 1px solid black; content: ""; left: 0px; position: absolute; right: 0px; top: 50%; }
.markdown-preview .flash { animation: flash 1s ease-out 1; outline: rgba(255, 0, 0, 0) solid 1px; }
.markdown-preview .flash:not(li) { display: block; }
.markdown-preview:not([data-use-github-style]) { padding: 2em; font-size: 1.2em; color: rgb(171, 178, 191); overflow: auto; background-color: rgb(40, 44, 52); }
.markdown-preview:not([data-use-github-style]) > :first-child { margin-top: 0px; }
.markdown-preview:not([data-use-github-style]) h1, .markdown-preview:not([data-use-github-style]) h2, .markdown-preview:not([data-use-github-style]) h3, .markdown-preview:not([data-use-github-style]) h4, .markdown-preview:not([data-use-github-style]) h5, .markdown-preview:not([data-use-github-style]) h6 { line-height: 1.2; margin-top: 1.5em; margin-bottom: 0.5em; color: rgb(255, 255, 255); }
.markdown-preview:not([data-use-github-style]) h1 { font-size: 2.4em; font-weight: 300; }
.markdown-preview:not([data-use-github-style]) h2 { font-size: 1.8em; font-weight: 400; }
.markdown-preview:not([data-use-github-style]) h3 { font-size: 1.5em; font-weight: 500; }
.markdown-preview:not([data-use-github-style]) h4 { font-size: 1.2em; font-weight: 600; }
.markdown-preview:not([data-use-github-style]) h5 { font-size: 1.1em; font-weight: 600; }
.markdown-preview:not([data-use-github-style]) h6 { font-size: 1em; font-weight: 600; }
.markdown-preview:not([data-use-github-style]) strong { color: rgb(255, 255, 255); }
.markdown-preview:not([data-use-github-style]) del { color: rgb(124, 135, 156); }
.markdown-preview:not([data-use-github-style]) a, .markdown-preview:not([data-use-github-style]) a code { color: rgb(82, 139, 255); }
.markdown-preview:not([data-use-github-style]) img { max-width: 100%; }
.markdown-preview:not([data-use-github-style]) > p { margin-top: 0px; margin-bottom: 1.5em; }
.markdown-preview:not([data-use-github-style]) > ul, .markdown-preview:not([data-use-github-style]) > ol { margin-bottom: 1.5em; }
.markdown-preview:not([data-use-github-style]) blockquote { margin: 1.5em 0px; font-size: inherit; color: rgb(124, 135, 156); border-color: rgb(75, 83, 98); border-width: 4px; }
.markdown-preview:not([data-use-github-style]) hr { margin: 3em 0px; border-top: 2px dashed rgb(75, 83, 98); background: none; }
.markdown-preview:not([data-use-github-style]) table { margin: 1.5em 0px; }
.markdown-preview:not([data-use-github-style]) th { color: rgb(255, 255, 255); }
.markdown-preview:not([data-use-github-style]) th, .markdown-preview:not([data-use-github-style]) td { padding: 0.66em 1em; border: 1px solid rgb(75, 83, 98); }
.markdown-preview:not([data-use-github-style]) code { color: rgb(255, 255, 255); background-color: rgb(58, 63, 75); }
.markdown-preview:not([data-use-github-style]) pre.editor-colors { margin: 1.5em 0px; padding: 1em; font-size: 0.92em; border-radius: 3px; background-color: rgb(49, 54, 63); }
.markdown-preview:not([data-use-github-style]) kbd { color: rgb(255, 255, 255); border-width: 1px 1px 2px; border-style: solid; border-color: rgb(75, 83, 98) rgb(75, 83, 98) rgb(62, 68, 81); background-color: rgb(58, 63, 75); }
.markdown-preview[data-use-github-style] { font-family: "Helvetica Neue", Helvetica, "Segoe UI", Arial, freesans, sans-serif; line-height: 1.6; word-wrap: break-word; padding: 30px; font-size: 16px; color: rgb(51, 51, 51); overflow: scroll; background-color: rgb(255, 255, 255); }
.markdown-preview[data-use-github-style] > :first-child { margin-top: 0px !important; }
.markdown-preview[data-use-github-style] > :last-child { margin-bottom: 0px !important; }
.markdown-preview[data-use-github-style] a:not([href]) { color: inherit; text-decoration: none; }
.markdown-preview[data-use-github-style] .absent { color: rgb(204, 0, 0); }
.markdown-preview[data-use-github-style] .anchor { position: absolute; top: 0px; left: 0px; display: block; padding-right: 6px; padding-left: 30px; margin-left: -30px; }
.markdown-preview[data-use-github-style] .anchor:focus { outline: none; }
.markdown-preview[data-use-github-style] h1, .markdown-preview[data-use-github-style] h2, .markdown-preview[data-use-github-style] h3, .markdown-preview[data-use-github-style] h4, .markdown-preview[data-use-github-style] h5, .markdown-preview[data-use-github-style] h6 { position: relative; margin-top: 1em; margin-bottom: 16px; font-weight: bold; line-height: 1.4; }
.markdown-preview[data-use-github-style] h1 .octicon-link, .markdown-preview[data-use-github-style] h2 .octicon-link, .markdown-preview[data-use-github-style] h3 .octicon-link, .markdown-preview[data-use-github-style] h4 .octicon-link, .markdown-preview[data-use-github-style] h5 .octicon-link, .markdown-preview[data-use-github-style] h6 .octicon-link { display: none; color: rgb(0, 0, 0); vertical-align: middle; }
.markdown-preview[data-use-github-style] h1:hover .anchor, .markdown-preview[data-use-github-style] h2:hover .anchor, .markdown-preview[data-use-github-style] h3:hover .anchor, .markdown-preview[data-use-github-style] h4:hover .anchor, .markdown-preview[data-use-github-style] h5:hover .anchor, .markdown-preview[data-use-github-style] h6:hover .anchor { padding-left: 8px; margin-left: -30px; text-decoration: none; }
.markdown-preview[data-use-github-style] h1:hover .anchor .octicon-link, .markdown-preview[data-use-github-style] h2:hover .anchor .octicon-link, .markdown-preview[data-use-github-style] h3:hover .anchor .octicon-link, .markdown-preview[data-use-github-style] h4:hover .anchor .octicon-link, .markdown-preview[data-use-github-style] h5:hover .anchor .octicon-link, .markdown-preview[data-use-github-style] h6:hover .anchor .octicon-link { display: inline-block; }
.markdown-preview[data-use-github-style] h1 tt, .markdown-preview[data-use-github-style] h2 tt, .markdown-preview[data-use-github-style] h3 tt, .markdown-preview[data-use-github-style] h4 tt, .markdown-preview[data-use-github-style] h5 tt, .markdown-preview[data-use-github-style] h6 tt, .markdown-preview[data-use-github-style] h1 code, .markdown-preview[data-use-github-style] h2 code, .markdown-preview[data-use-github-style] h3 code, .markdown-preview[data-use-github-style] h4 code, .markdown-preview[data-use-github-style] h5 code, .markdown-preview[data-use-github-style] h6 code { font-size: inherit; }
.markdown-preview[data-use-github-style] h1 { padding-bottom: 0.3em; font-size: 2.25em; line-height: 1.2; border-bottom: 1px solid rgb(238, 238, 238); }
.markdown-preview[data-use-github-style] h1 .anchor { line-height: 1; }
.markdown-preview[data-use-github-style] h2 { padding-bottom: 0.3em; font-size: 1.75em; line-height: 1.225; border-bottom: 1px solid rgb(238, 238, 238); }
.markdown-preview[data-use-github-style] h2 .anchor { line-height: 1; }
.markdown-preview[data-use-github-style] h3 { font-size: 1.5em; line-height: 1.43; }
.markdown-preview[data-use-github-style] h3 .anchor { line-height: 1.2; }
.markdown-preview[data-use-github-style] h4 { font-size: 1.25em; }
.markdown-preview[data-use-github-style] h4 .anchor { line-height: 1.2; }
.markdown-preview[data-use-github-style] h5 { font-size: 1em; }
.markdown-preview[data-use-github-style] h5 .anchor { line-height: 1.1; }
.markdown-preview[data-use-github-style] h6 { font-size: 1em; color: rgb(119, 119, 119); }
.markdown-preview[data-use-github-style] h6 .anchor { line-height: 1.1; }
.markdown-preview[data-use-github-style] p, .markdown-preview[data-use-github-style] blockquote, .markdown-preview[data-use-github-style] ul, .markdown-preview[data-use-github-style] ol, .markdown-preview[data-use-github-style] dl, .markdown-preview[data-use-github-style] table, .markdown-preview[data-use-github-style] pre { margin-top: 0px; margin-bottom: 16px; }
.markdown-preview[data-use-github-style] hr { height: 4px; padding: 0px; margin: 16px 0px; border: 0px none; background-color: rgb(231, 231, 231); }
.markdown-preview[data-use-github-style] ul, .markdown-preview[data-use-github-style] ol { padding-left: 2em; }
.markdown-preview[data-use-github-style] ul.no-list, .markdown-preview[data-use-github-style] ol.no-list { padding: 0px; list-style-type: none; }
.markdown-preview[data-use-github-style] ul ul, .markdown-preview[data-use-github-style] ul ol, .markdown-preview[data-use-github-style] ol ol, .markdown-preview[data-use-github-style] ol ul { margin-top: 0px; margin-bottom: 0px; }
.markdown-preview[data-use-github-style] li > p { margin-top: 16px; }
.markdown-preview[data-use-github-style] dl { padding: 0px; }
.markdown-preview[data-use-github-style] dl dt { padding: 0px; margin-top: 16px; font-size: 1em; font-style: italic; font-weight: bold; }
.markdown-preview[data-use-github-style] dl dd { padding: 0px 16px; margin-bottom: 16px; }
.markdown-preview[data-use-github-style] blockquote { padding: 0px 15px; color: rgb(119, 119, 119); border-left: 4px solid rgb(221, 221, 221); }
.markdown-preview[data-use-github-style] blockquote > :first-child { margin-top: 0px; }
.markdown-preview[data-use-github-style] blockquote > :last-child { margin-bottom: 0px; }
.markdown-preview[data-use-github-style] table { display: block; width: 100%; overflow: auto; word-break: keep-all; }
.markdown-preview[data-use-github-style] table th { font-weight: bold; }
.markdown-preview[data-use-github-style] table th, .markdown-preview[data-use-github-style] table td { padding: 6px 13px; border: 1px solid rgb(221, 221, 221); }
.markdown-preview[data-use-github-style] table tr { border-top: 1px solid rgb(204, 204, 204); background-color: rgb(255, 255, 255); }
.markdown-preview[data-use-github-style] table tr:nth-child(2n) { background-color: rgb(248, 248, 248); }
.markdown-preview[data-use-github-style] img { max-width: 100%; box-sizing: border-box; }
.markdown-preview[data-use-github-style] .emoji { max-width: none; }
.markdown-preview[data-use-github-style] span.frame { display: block; overflow: hidden; }
.markdown-preview[data-use-github-style] span.frame > span { display: block; float: left; width: auto; padding: 7px; margin: 13px 0px 0px; overflow: hidden; border: 1px solid rgb(221, 221, 221); }
.markdown-preview[data-use-github-style] span.frame span img { display: block; float: left; }
.markdown-preview[data-use-github-style] span.frame span span { display: block; padding: 5px 0px 0px; clear: both; color: rgb(51, 51, 51); }
.markdown-preview[data-use-github-style] span.align-center { display: block; overflow: hidden; clear: both; }
.markdown-preview[data-use-github-style] span.align-center > span { display: block; margin: 13px auto 0px; overflow: hidden; text-align: center; }
.markdown-preview[data-use-github-style] span.align-center span img { margin: 0px auto; text-align: center; }
.markdown-preview[data-use-github-style] span.align-right { display: block; overflow: hidden; clear: both; }
.markdown-preview[data-use-github-style] span.align-right > span { display: block; margin: 13px 0px 0px; overflow: hidden; text-align: right; }
.markdown-preview[data-use-github-style] span.align-right span img { margin: 0px; text-align: right; }
.markdown-preview[data-use-github-style] span.float-left { display: block; float: left; margin-right: 13px; overflow: hidden; }
.markdown-preview[data-use-github-style] span.float-left span { margin: 13px 0px 0px; }
.markdown-preview[data-use-github-style] span.float-right { display: block; float: right; margin-left: 13px; overflow: hidden; }
.markdown-preview[data-use-github-style] span.float-right > span { display: block; margin: 13px auto 0px; overflow: hidden; text-align: right; }
.markdown-preview[data-use-github-style] code, .markdown-preview[data-use-github-style] tt { padding: 0.2em 0px; margin: 0px; font-size: 85%; border-radius: 3px; background-color: rgba(0, 0, 0, 0.0392157); }
.markdown-preview[data-use-github-style] code::before, .markdown-preview[data-use-github-style] tt::before, .markdown-preview[data-use-github-style] code::after, .markdown-preview[data-use-github-style] tt::after { letter-spacing: -0.2em; content: " "; }
.markdown-preview[data-use-github-style] code br, .markdown-preview[data-use-github-style] tt br { display: none; }
.markdown-preview[data-use-github-style] del code { text-decoration: inherit; }
.markdown-preview[data-use-github-style] pre > code { padding: 0px; margin: 0px; font-size: 100%; word-break: normal; white-space: pre; border: 0px; background: transparent; }
.markdown-preview[data-use-github-style] .highlight { margin-bottom: 16px; }
.markdown-preview[data-use-github-style] .highlight pre, .markdown-preview[data-use-github-style] pre { padding: 16px; overflow: auto; font-size: 85%; line-height: 1.45; border-radius: 3px; background-color: rgb(247, 247, 247); }
.markdown-preview[data-use-github-style] .highlight pre { margin-bottom: 0px; word-break: normal; }
.markdown-preview[data-use-github-style] pre { word-wrap: normal; }
.markdown-preview[data-use-github-style] pre code, .markdown-preview[data-use-github-style] pre tt { display: inline; max-width: initial; padding: 0px; margin: 0px; overflow: initial; line-height: inherit; word-wrap: normal; border: 0px; background-color: transparent; }
.markdown-preview[data-use-github-style] pre code::before, .markdown-preview[data-use-github-style] pre tt::before, .markdown-preview[data-use-github-style] pre code::after, .markdown-preview[data-use-github-style] pre tt::after { content: normal; }
.markdown-preview[data-use-github-style] kbd { display: inline-block; padding: 3px 5px; font-size: 11px; line-height: 10px; color: rgb(85, 85, 85); vertical-align: middle; border-width: 1px; border-style: solid; border-color: rgb(204, 204, 204) rgb(204, 204, 204) rgb(187, 187, 187); border-radius: 3px; box-shadow: rgb(187, 187, 187) 0px -1px 0px inset; background-color: rgb(252, 252, 252); }
.markdown-preview[data-use-github-style] a { color: rgb(51, 122, 183); }
.markdown-preview[data-use-github-style] code { color: inherit; }
.markdown-preview[data-use-github-style] pre.editor-colors { padding: 0.8em 1em; margin-bottom: 1em; font-size: 0.85em; border-radius: 4px; overflow: auto; }
.scrollbars-visible-always .markdown-preview pre.editor-colors .vertical-scrollbar, .scrollbars-visible-always .markdown-preview pre.editor-colors .horizontal-scrollbar { visibility: hidden; }
.scrollbars-visible-always .markdown-preview pre.editor-colors:hover .vertical-scrollbar, .scrollbars-visible-always .markdown-preview pre.editor-colors:hover .horizontal-scrollbar { visibility: visible; }
.markdown-preview .task-list-item-checkbox { position: absolute; margin: 0.25em 0px 0px -1.4em; }
.bracket-matcher .region {
  border-bottom: 1px dotted lime;
  position: absolute;
}

.spell-check-misspelling .region {
  border-bottom: 2px dotted rgba(255, 51, 51, 0.75);
}
.spell-check-corrections {
  width: 25em !important;
}

pre.editor-colors {
  background-color: #282c34;
  color: #abb2bf;
}
pre.editor-colors .line.cursor-line {
  background-color: rgba(153, 187, 255, 0.04);
}
pre.editor-colors .invisible {
  color: #abb2bf;
}
pre.editor-colors .cursor {
  border-left: 2px solid #528bff;
}
pre.editor-colors .selection .region {
  background-color: #3e4451;
}
pre.editor-colors .bracket-matcher .region {
  border-bottom: 1px solid #528bff;
  box-sizing: border-box;
}
pre.editor-colors .invisible-character {
  color: rgba(171, 178, 191, 0.15);
}
pre.editor-colors .indent-guide {
  color: rgba(171, 178, 191, 0.15);
}
pre.editor-colors .wrap-guide {
  background-color: rgba(171, 178, 191, 0.15);
}
pre.editor-colors .find-result .region.region.region,
pre.editor-colors .current-result .region.region.region {
  border-radius: 2px;
  background-color: rgba(82, 139, 255, 0.24);
  transition: border-color 0.4s;
}
pre.editor-colors .find-result .region.region.region {
  border: 2px solid transparent;
}
pre.editor-colors .current-result .region.region.region {
  border: 2px solid #528bff;
  transition-duration: .1s;
}
pre.editor-colors .gutter .line-number {
  color: #636d83;
  -webkit-font-smoothing: antialiased;
}
pre.editor-colors .gutter .line-number.cursor-line {
  color: #abb2bf;
  background-color: #2c313a;
}
pre.editor-colors .gutter .line-number.cursor-line-no-selection {
  background-color: transparent;
}
pre.editor-colors .gutter .line-number .icon-right {
  color: #abb2bf;
}
pre.editor-colors .gutter:not(.git-diff-icon) .line-number.git-line-removed.git-line-removed::before {
  bottom: -3px;
}
pre.editor-colors .gutter:not(.git-diff-icon) .line-number.git-line-removed::after {
  content: "";
  position: absolute;
  left: 0px;
  bottom: 0px;
  width: 25px;
  border-bottom: 1px dotted rgba(224, 82, 82, 0.5);
  pointer-events: none;
}
pre.editor-colors .gutter .line-number.folded,
pre.editor-colors .gutter .line-number:after,
pre.editor-colors .fold-marker:after {
  color: #abb2bf;
}
.syntax--comment {
  color: #5c6370;
  font-style: italic;
}
.syntax--comment .syntax--markup.syntax--link {
  color: #5c6370;
}
.syntax--entity.syntax--name.syntax--type {
  color: #e5c07b;
}
.syntax--entity.syntax--other.syntax--inherited-class {
  color: #98c379;
}
.syntax--keyword {
  color: #c678dd;
}
.syntax--keyword.syntax--control {
  color: #c678dd;
}
.syntax--keyword.syntax--operator {
  color: #abb2bf;
}
.syntax--keyword.syntax--other.syntax--special-method {
  color: #61afef;
}
.syntax--keyword.syntax--other.syntax--unit {
  color: #d19a66;
}
.syntax--storage {
  color: #c678dd;
}
.syntax--storage.syntax--type.syntax--annotation,
.syntax--storage.syntax--type.syntax--primitive {
  color: #c678dd;
}
.syntax--storage.syntax--modifier.syntax--package,
.syntax--storage.syntax--modifier.syntax--import {
  color: #abb2bf;
}
.syntax--constant {
  color: #d19a66;
}
.syntax--constant.syntax--variable {
  color: #d19a66;
}
.syntax--constant.syntax--character.syntax--escape {
  color: #56b6c2;
}
.syntax--constant.syntax--numeric {
  color: #d19a66;
}
.syntax--constant.syntax--other.syntax--color {
  color: #56b6c2;
}
.syntax--constant.syntax--other.syntax--symbol {
  color: #56b6c2;
}
.syntax--variable {
  color: #e06c75;
}
.syntax--variable.syntax--interpolation {
  color: #be5046;
}
.syntax--variable.syntax--parameter {
  color: #abb2bf;
}
.syntax--string {
  color: #98c379;
}
.syntax--string.syntax--regexp {
  color: #56b6c2;
}
.syntax--string.syntax--regexp .syntax--source.syntax--ruby.syntax--embedded {
  color: #e5c07b;
}
.syntax--string.syntax--other.syntax--link {
  color: #e06c75;
}
.syntax--punctuation.syntax--definition.syntax--comment {
  color: #5c6370;
}
.syntax--punctuation.syntax--definition.syntax--method-parameters,
.syntax--punctuation.syntax--definition.syntax--function-parameters,
.syntax--punctuation.syntax--definition.syntax--parameters,
.syntax--punctuation.syntax--definition.syntax--separator,
.syntax--punctuation.syntax--definition.syntax--seperator,
.syntax--punctuation.syntax--definition.syntax--array {
  color: #abb2bf;
}
.syntax--punctuation.syntax--definition.syntax--heading,
.syntax--punctuation.syntax--definition.syntax--identity {
  color: #61afef;
}
.syntax--punctuation.syntax--definition.syntax--bold {
  color: #e5c07b;
  font-weight: bold;
}
.syntax--punctuation.syntax--definition.syntax--italic {
  color: #c678dd;
  font-style: italic;
}
.syntax--punctuation.syntax--section.syntax--embedded {
  color: #be5046;
}
.syntax--punctuation.syntax--section.syntax--method,
.syntax--punctuation.syntax--section.syntax--class,
.syntax--punctuation.syntax--section.syntax--inner-class {
  color: #abb2bf;
}
.syntax--support.syntax--class {
  color: #e5c07b;
}
.syntax--support.syntax--type {
  color: #56b6c2;
}
.syntax--support.syntax--function {
  color: #56b6c2;
}
.syntax--support.syntax--function.syntax--any-method {
  color: #61afef;
}
.syntax--entity.syntax--name.syntax--function {
  color: #61afef;
}
.syntax--entity.syntax--name.syntax--class,
.syntax--entity.syntax--name.syntax--type.syntax--class {
  color: #e5c07b;
}
.syntax--entity.syntax--name.syntax--section {
  color: #61afef;
}
.syntax--entity.syntax--name.syntax--tag {
  color: #e06c75;
}
.syntax--entity.syntax--other.syntax--attribute-name {
  color: #d19a66;
}
.syntax--entity.syntax--other.syntax--attribute-name.syntax--id {
  color: #61afef;
}
.syntax--meta.syntax--class {
  color: #e5c07b;
}
.syntax--meta.syntax--class.syntax--body {
  color: #abb2bf;
}
.syntax--meta.syntax--method-call,
.syntax--meta.syntax--method {
  color: #abb2bf;
}
.syntax--meta.syntax--definition.syntax--variable {
  color: #e06c75;
}
.syntax--meta.syntax--link {
  color: #d19a66;
}
.syntax--meta.syntax--require {
  color: #61afef;
}
.syntax--meta.syntax--selector {
  color: #c678dd;
}
.syntax--meta.syntax--separator {
  background-color: #373b41;
  color: #abb2bf;
}
.syntax--meta.syntax--tag {
  color: #abb2bf;
}
.syntax--underline {
  text-decoration: underline;
}
.syntax--none {
  color: #abb2bf;
}
.syntax--invalid.syntax--deprecated {
  color: #523d14 !important;
  background-color: #e0c285 !important;
}
.syntax--invalid.syntax--illegal {
  color: #ffffff !important;
  background-color: #e05252 !important;
}
.syntax--markup.syntax--bold {
  color: #d19a66;
  font-weight: bold;
}
.syntax--markup.syntax--changed {
  color: #c678dd;
}
.syntax--markup.syntax--deleted {
  color: #e06c75;
}
.syntax--markup.syntax--italic {
  color: #c678dd;
  font-style: italic;
}
.syntax--markup.syntax--heading {
  color: #e06c75;
}
.syntax--markup.syntax--heading .syntax--punctuation.syntax--definition.syntax--heading {
  color: #61afef;
}
.syntax--markup.syntax--link {
  color: #c678dd;
}
.syntax--markup.syntax--inserted {
  color: #98c379;
}
.syntax--markup.syntax--quote {
  color: #d19a66;
}
.syntax--markup.syntax--raw {
  color: #98c379;
}
.syntax--source.syntax--c .syntax--keyword.syntax--operator {
  color: #c678dd;
}
.syntax--source.syntax--cpp .syntax--keyword.syntax--operator {
  color: #c678dd;
}
.syntax--source.syntax--cs .syntax--keyword.syntax--operator {
  color: #c678dd;
}
.syntax--source.syntax--css .syntax--property-name,
.syntax--source.syntax--css .syntax--property-value {
  color: #828997;
}
.syntax--source.syntax--css .syntax--property-name.syntax--support,
.syntax--source.syntax--css .syntax--property-value.syntax--support {
  color: #abb2bf;
}
.syntax--source.syntax--gfm .syntax--markup {
  -webkit-font-smoothing: auto;
}
.syntax--source.syntax--gfm .syntax--link .syntax--entity {
  color: #61afef;
}
.syntax--source.syntax--go .syntax--storage.syntax--type.syntax--string {
  color: #c678dd;
}
.syntax--source.syntax--ini .syntax--keyword.syntax--other.syntax--definition.syntax--ini {
  color: #e06c75;
}
.syntax--source.syntax--java .syntax--storage.syntax--modifier.syntax--import {
  color: #e5c07b;
}
.syntax--source.syntax--java .syntax--storage.syntax--type {
  color: #e5c07b;
}
.syntax--source.syntax--java .syntax--keyword.syntax--operator.syntax--instanceof {
  color: #c678dd;
}
.syntax--source.syntax--java-properties .syntax--meta.syntax--key-pair {
  color: #e06c75;
}
.syntax--source.syntax--java-properties .syntax--meta.syntax--key-pair > .syntax--punctuation {
  color: #abb2bf;
}
.syntax--source.syntax--js .syntax--keyword.syntax--operator {
  color: #56b6c2;
}
.syntax--source.syntax--js .syntax--keyword.syntax--operator.syntax--delete,
.syntax--source.syntax--js .syntax--keyword.syntax--operator.syntax--in,
.syntax--source.syntax--js .syntax--keyword.syntax--operator.syntax--of,
.syntax--source.syntax--js .syntax--keyword.syntax--operator.syntax--instanceof,
.syntax--source.syntax--js .syntax--keyword.syntax--operator.syntax--new,
.syntax--source.syntax--js .syntax--keyword.syntax--operator.syntax--typeof,
.syntax--source.syntax--js .syntax--keyword.syntax--operator.syntax--void {
  color: #c678dd;
}
.syntax--source.syntax--json .syntax--meta.syntax--structure.syntax--dictionary.syntax--json > .syntax--string.syntax--quoted.syntax--json {
  color: #e06c75;
}
.syntax--source.syntax--json .syntax--meta.syntax--structure.syntax--dictionary.syntax--json > .syntax--string.syntax--quoted.syntax--json > .syntax--punctuation.syntax--string {
  color: #e06c75;
}
.syntax--source.syntax--json .syntax--meta.syntax--structure.syntax--dictionary.syntax--json > .syntax--value.syntax--json > .syntax--string.syntax--quoted.syntax--json,
.syntax--source.syntax--json .syntax--meta.syntax--structure.syntax--array.syntax--json > .syntax--value.syntax--json > .syntax--string.syntax--quoted.syntax--json,
.syntax--source.syntax--json .syntax--meta.syntax--structure.syntax--dictionary.syntax--json > .syntax--value.syntax--json > .syntax--string.syntax--quoted.syntax--json > .syntax--punctuation,
.syntax--source.syntax--json .syntax--meta.syntax--structure.syntax--array.syntax--json > .syntax--value.syntax--json > .syntax--string.syntax--quoted.syntax--json > .syntax--punctuation {
  color: #98c379;
}
.syntax--source.syntax--json .syntax--meta.syntax--structure.syntax--dictionary.syntax--json > .syntax--constant.syntax--language.syntax--json,
.syntax--source.syntax--json .syntax--meta.syntax--structure.syntax--array.syntax--json > .syntax--constant.syntax--language.syntax--json {
  color: #56b6c2;
}
.syntax--source.syntax--ruby .syntax--constant.syntax--other.syntax--symbol > .syntax--punctuation {
  color: inherit;
}
.syntax--source.syntax--python .syntax--keyword.syntax--operator.syntax--logical.syntax--python {
  color: #c678dd;
}
.syntax--source.syntax--python .syntax--variable.syntax--parameter {
  color: #d19a66;
}
</style>
  </head>
  <body class='markdown-preview' data-use-github-style><h1 id="strings-sketch">Strings Sketch</h1>
<h2 id="misc">Misc</h2>
<h3 id="todo">Todo</h3>
<ul>
<li>setup test project.</li>
<li>tests for static_assert/compilation failure.</li>
<li>Read: Python 3 strings</li>
<li>Read: Swift strings</li>
<li>Read: D-strings.</li>
<li>Watch: Nicolas Fleury CppCon 16.</li>
<li>Review: Eric T.</li>
<li>Review: Nicolas Fleury <a href="mailto:nidoizo@gmail.com">&#x6e;&#x69;&#x64;&#x6f;&#x69;&#x7a;&#111;&#64;&#x67;&#x6d;&#x61;&#105;&#x6c;&#46;&#99;&#x6f;&#109;</a></li>
<li>Review: Sofia Mihail, Vlad,</li>
</ul>
<h3 id="references">References</h3>
<ul>
<li><a href="https://en.wikipedia.org/wiki/UTF-8">https://en.wikipedia.org/wiki/UTF-8</a></li>
<li><code>text_view</code><ul>
<li><a href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2016/p0244r1.html">http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2016/p0244r1.html</a></li>
</ul>
</li>
<li><code>folly::FixedString</code><ul>
<li><a href="https://github.com/facebook/folly/blob/master/folly/FixedString.h">https://github.com/facebook/folly/blob/master/folly/FixedString.h</a></li>
</ul>
</li>
<li><code>std::codecvt</code><ul>
<li><a href="http://en.cppreference.com/w/cpp/locale/codecvt">http://en.cppreference.com/w/cpp/locale/codecvt</a></li>
</ul>
</li>
</ul>
<h2 id="submission-form">Submission form</h2>
<h3 id="title">Title</h3>
<p>Rethinking Strings</p>
<h3 id="session-description-abstract-">Session Description (Abstract)</h3>
<p>At VMware <code>std::string</code> has served us well. We have built and shipped large
codebases around it. However, that experience has also taught us some of its
shortcomings. Now is a good time to take a step back and re-evaluate the string
design space. Why now? The context has changed dramatically since the dawn of
<code>basic_string</code>. The UTF family is the de facto encoding standard. 64bit
addressing will last much longer, in a much wider range of devices, than prior
addressing modes.  We have <code>constexpr</code>, and soon will have ranges and
reflection. The library now includes <code>string_view</code>, all three major STL
implementations use the small string optimization, and Eric Neibler has given us
<code>folly::FixedString</code>. A <code>std::text_view</code> proposal is in flight. Even
<code>std::optional</code>, and smart pointers have some something to say about strings.</p>
<p>In this talk we will dissect strings along dimensions such as storage duration,
encoding, mutability, etc., and then see if we can knit it all back together
into a cohesive, modern, set of library and language features. I won&#39;t have all
the answers, so show up and speak up!</p>
<h3 id="bio">Bio</h3>
<p>Mark is an eleven-year veteran at VMware where he works on core C++ libraries
and applications for the vSphere product line. Most recently he has been
instigating the move to C++11/14/17 and modernizing VMware&#39;s C++ Style Guide. In
2013, during a VMware sponsored sabbatical-of-a-lifetime, he was embedded in the
IT department at SpaceX. In past positions, he has worked on iOS application
wrapping, software telephony, and multidimensional databases. When some of our
attendees were still in nappies, he worked in Apple&#39;s Evangelism group on
international system software.</p>
<h3 id="history">History</h3>
<p>This is a new talk, tailored for CppNow.</p>
<h3 id="video">Video</h3>
<p>While I occasionally present technical topics internally at VMware, the last
time I presented publicly was back at the 1992 WWDC. Sadly, the Computer
History museum does not have those recordings! However, I have reconstructed a
short internal VMware talk for this submission:</p>
<h3 id="audience-description">Audience Description</h3>
<p>Library writers, performance critical systems, l10n experts</p>
<h3 id="comments">Comments</h3>
<h2 id="outline">Outline</h2>
<h3 id="intro">Intro</h3>
<p>... I will start with two thoughts that motivated this talk...</p>
<h4 id="1-the-cow-is-dead">1. The COW is Dead</h4>
<p>I work with code that still uses GCC&#39;s copy on write (COW) strings. We have even
<em>tuned</em> our code to that implementation. However, we know that we must move to a
standard compliant implementation sooner rather than later. I think about this
transition a lot. I see it as an opportunity to re-think our use of strings.
Building this talk is part of that process.</p>
<p>TODO: Extend this section with an explanation of why C++11 disallows COW?</p>
<h4 id="2-string_view-is-a-beautiful-thing-">2. <code>string_view</code> is a Beautiful Thing...</h4>
<p>... almost.</p>
<p>GCC&#39;s small string optimized (SSO) strings have a layout like this:</p>
<pre class="editor-colors lang-c++"><div class="line"><span class="syntax--source syntax--cpp"><span class="syntax--meta syntax--class-struct-block syntax--cpp"><span class="syntax--storage syntax--type syntax--cpp"><span>struct</span></span><span>&nbsp;</span><span class="syntax--entity syntax--name syntax--type syntax--cpp"><span>sso_string</span></span><span>&nbsp;</span><span class="syntax--punctuation syntax--section syntax--block syntax--begin syntax--cpp"><span>{</span></span></span></span></div><div class="line"><span class="syntax--source syntax--cpp"><span class="syntax--meta syntax--class-struct-block syntax--cpp"><span>&nbsp;&nbsp;</span><span class="syntax--storage syntax--type syntax--c"><span>char</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--c"><span>*</span></span><span>data;</span></span></span></div><div class="line"><span class="syntax--source syntax--cpp"><span class="syntax--meta syntax--class-struct-block syntax--cpp"><span>&nbsp;&nbsp;</span><span class="syntax--support syntax--type syntax--sys-types syntax--c"><span>size_t</span></span><span>&nbsp;len;</span></span></span></div><div class="line"><span class="syntax--source syntax--cpp"><span class="syntax--meta syntax--class-struct-block syntax--cpp"><span>&nbsp;&nbsp;</span><span class="syntax--storage syntax--type syntax--c"><span>char</span></span><span>&nbsp;extra[</span><span class="syntax--constant syntax--numeric syntax--c"><span>16</span></span><span>];</span></span></span></div><div class="line"><span class="syntax--source syntax--cpp"><span class="syntax--meta syntax--class-struct-block syntax--cpp"><span class="syntax--punctuation syntax--section syntax--block syntax--end syntax--cpp"><span>}</span></span></span><span>;</span></span></div></pre>
<p>When I first saw that I thought &quot;of course&quot; because then clearly a
<code>string_view</code> is just:</p>
<pre class="editor-colors lang-c++"><div class="line"><span class="syntax--source syntax--cpp"><span class="syntax--meta syntax--class-struct-block syntax--cpp"><span class="syntax--storage syntax--type syntax--cpp"><span>struct</span></span><span>&nbsp;</span><span class="syntax--entity syntax--name syntax--type syntax--cpp"><span>string_view</span></span><span>&nbsp;</span><span class="syntax--punctuation syntax--section syntax--block syntax--begin syntax--cpp"><span>{</span></span></span></span></div><div class="line"><span class="syntax--source syntax--cpp"><span class="syntax--meta syntax--class-struct-block syntax--cpp"><span>&nbsp;&nbsp;</span><span class="syntax--storage syntax--type syntax--c"><span>char</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--c"><span>*</span></span><span>data;</span></span></span></div><div class="line"><span class="syntax--source syntax--cpp"><span class="syntax--meta syntax--class-struct-block syntax--cpp"><span>&nbsp;&nbsp;</span><span class="syntax--support syntax--type syntax--sys-types syntax--c"><span>size_t</span></span><span>&nbsp;len;</span></span></span></div><div class="line"><span class="syntax--source syntax--cpp"><span class="syntax--meta syntax--class-struct-block syntax--cpp"><span class="syntax--punctuation syntax--section syntax--block syntax--end syntax--cpp"><span>}</span></span></span><span>;</span></span></div></pre>
<p>So, a string slices effortlessly to a string_view. Brilliant!</p>
<p>Then I looked at GCC&#39;s <code>string_view</code> and found:</p>
<pre class="editor-colors lang-c++"><div class="line"><span class="syntax--source syntax--cpp"><span class="syntax--meta syntax--class-struct-block syntax--cpp"><span class="syntax--storage syntax--type syntax--cpp"><span>struct</span></span><span>&nbsp;</span><span class="syntax--entity syntax--name syntax--type syntax--cpp"><span>string_view</span></span><span>&nbsp;</span><span class="syntax--punctuation syntax--section syntax--block syntax--begin syntax--cpp"><span>{</span></span></span></span></div><div class="line"><span class="syntax--source syntax--cpp"><span class="syntax--meta syntax--class-struct-block syntax--cpp"><span>&nbsp;&nbsp;</span><span class="syntax--support syntax--type syntax--sys-types syntax--c"><span>size_t</span></span><span>&nbsp;len;</span></span></span></div><div class="line"><span class="syntax--source syntax--cpp"><span class="syntax--meta syntax--class-struct-block syntax--cpp"><span>&nbsp;&nbsp;</span><span class="syntax--storage syntax--type syntax--c"><span>char</span></span><span class="syntax--keyword syntax--operator syntax--c"><span>*</span></span><span>&nbsp;data;</span></span></span></div><div class="line"><span class="syntax--source syntax--cpp"><span class="syntax--meta syntax--class-struct-block syntax--cpp"><span class="syntax--punctuation syntax--section syntax--block syntax--end syntax--cpp"><span>}</span></span></span><span>;</span></span></div></pre>
<p>Sigh. Well at least changing one or the other and measuring the effects would be
a nice experiment!</p>
<p>TODO: check libc++, msvc.</p>
<h4 id="composing-and-converting">Composing and Converting</h4>
<p>This got me thinking: How could string-ish things compose and convert nicely
and more generally?</p>
<p>Consider:</p>
<pre class="editor-colors lang-c++"><div class="line"><span class="syntax--source syntax--cpp"><span class="syntax--meta syntax--class-struct-block syntax--cpp"><span class="syntax--storage syntax--type syntax--cpp"><span>struct</span></span><span>&nbsp;</span><span class="syntax--entity syntax--name syntax--type syntax--cpp"><span>c_string</span></span><span>&nbsp;</span><span class="syntax--punctuation syntax--section syntax--block syntax--begin syntax--cpp"><span>{</span></span></span></span></div><div class="line"><span class="syntax--source syntax--cpp"><span class="syntax--meta syntax--class-struct-block syntax--cpp"><span>&nbsp;&nbsp;</span><span class="syntax--storage syntax--type syntax--c"><span>char</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--c"><span>*</span></span><span>data;&nbsp;</span><span class="syntax--comment syntax--line syntax--double-slash syntax--cpp"><span class="syntax--punctuation syntax--definition syntax--comment syntax--cpp"><span>//</span></span><span>&nbsp;null&nbsp;terminated.</span><span>&nbsp;</span></span></span></span></div><div class="line"><span class="syntax--source syntax--cpp"><span class="syntax--meta syntax--class-struct-block syntax--cpp"><span class="syntax--punctuation syntax--section syntax--block syntax--end syntax--cpp"><span>}</span></span></span><span>;</span></span></div></pre>
<p>Thus an <code>sso_string</code> IsA <code>string_view</code> <em>or</em> IsA <code>c_string</code> (as long as
the <code>sso_string</code> null terminates data).</p>
<p>What if we stole some bits from the size? On 64-bit systems, <code>size_t</code> seem like
overkill ,so we have a lot of room to maneuver.</p>
<h3 id="what-if-">What If ..</h3>
<p>I realized that this was an opportunity to re-think things more
broadly; to see if we could address many issues in one go. Were there more
&quot;effortless conversions&quot; that could be provided? What other use cases could we
cover with those extra bits?</p>
<p>So, I dusted off a long &quot;wish list&quot; for strings that we had accumulated over the
years. Let&#39;s review some of the highlights.</p>
<h3 id="history">History</h3>
<h4 id="std-string-everywhere">std::string Everywhere</h4>
<p>The codebase that I work on began over ten years ago with a clean slate and
adopted &quot;std::string everywhere&quot;. This worked well while the project was
evolving quickly and adding features. Later as changes slowed and we started
focusing on macro-algorithmic performance, it still worked.</p>
<p>However, several years ago we started working more on micro-optimizations -- making
every cycle, and every byte of generated code count. This forced us to take a
harder look at &quot;string everywhere&quot;.</p>
<h4 id="std-string-refactoring">std::string Refactoring</h4>
<p>Some common refactorings:</p>
<ul>
<li>Convert <code>static string const</code> to <code>char const[]</code><ul>
<li>Saves binary size, static ctors and dtors, and indirections to heap.</li>
<li>Generates temporaries when passed to <code>f(string const&amp;)</code> which, remember,
we have everywhere.</li>
</ul>
</li>
<li>Convert arguments from <code>string const&amp;</code> to <code>char const*</code>.<ul>
<li>Update virally...</li>
<li>Pay the strlen cost.</li>
</ul>
</li>
<li>Or, maintain two overloads. Not great.</li>
</ul>
<p>I&#39;m hoping that <code>[constexpr] string_view</code> will help here.</p>
<h4 id="std-string-builders">std::string Builders</h4>
<p>Noob ex-Java programmers often wrote anti-patterns like:</p>
<pre class="editor-colors lang-c++"><div class="line"><span class="syntax--source syntax--cpp"><span>&nbsp;&nbsp;a&nbsp;</span><span class="syntax--keyword syntax--operator syntax--assignment syntax--c"><span>=</span></span><span>&nbsp;a&nbsp;</span><span class="syntax--keyword syntax--operator syntax--c"><span>+</span></span><span>&nbsp;</span><span class="syntax--string syntax--quoted syntax--double syntax--cpp"><span class="syntax--punctuation syntax--definition syntax--string syntax--begin syntax--cpp"><span>&quot;</span></span><span>_</span><span class="syntax--punctuation syntax--definition syntax--string syntax--end syntax--cpp"><span>&quot;</span></span></span><span>&nbsp;</span><span class="syntax--keyword syntax--operator syntax--c"><span>+</span></span><span>&nbsp;b;</span></span></div></pre>
<p>Our profilers found these in droves.</p>
<p>So:</p>
<ul>
<li>We wrote concatenation helpers, and</li>
<li>Fast type-safe printf like formatters.</li>
</ul>
<p>The key was reserving capacity to minimize allocations.</p>
<p>These were &quot;builders&quot; a la Java&#39;s string builder. Keep in mind that the builder
pattern works well with <em>immutable</em> data. Immutability will come up again.</p>
<h4 id="sso-and-cow-locality">SSO and COW - locality</h4>
<p>We compiled for both msvc and GCC. With msvc we had the SSO and we designed
around that. For example, we put short identifiers in strings. They lived on the
stack, or inline at the top of objects - a locality win. However, with GCC&#39;s
copy on write (COW) string we had reduced locality - a loss. In fact, this loss
drove us to a deep refactoring of these identifiers.</p>
<p>Lesson: locality is important.</p>
<h4 id="sso-and-cow-sharing">SSO and COW - sharing</h4>
<p>It turned out that our most memory constrained processes were built with GCC. In
one case when we faced a late-in-the-game ship stopping OOM condition the fix
was to carefully craft our code to &quot;connect&quot; the lifetime of strings and
preserve COW sharing.</p>
<p>OTOH reasoning about how COW sharing works can be non-intuitive:</p>
<p>TODO: code example, how reserve doesn&#39;t work as well as you&#39;d like....</p>
<p>Lesson: sharing is important.</p>
<h4 id="sso-and-cow-size">SSO and COW - size</h4>
<p>SSO strings are <strong>big</strong>, 24 or 32 bytes. In our &quot;<code>Optional&lt;string&gt;</code>&quot; SSO was too
expensive, as most of our optional strings were unset. So, we specialized
<code>Optional&lt;string&gt;</code> to hold a <code>string *</code> -- saving space for the unset case but
adding an indirection / decreasing locality for the set case. That was
unfortunate.</p>
<p>On the other hand, a COW string was only one pointer, so with GCC we
conditionally compiled <code>Optional&lt;string&gt;</code> to not add the indirection.</p>
<p>Side note: A GCC COW string that&#39;s just <code>0</code> is not valid. We could implement
<code>Optional&lt;string&gt;</code> as a single pointer sized value. More on this later!</p>
<h4 id="cow-bug">COW Bug</h4>
<p>There&#39;s a subtle, but unresolved bug in GCC&#39;s COW implementation. We live with
it, but it haunts us every time we see memory corruption. So far, we have not
hit it. We think.</p>
<p>TODO: dig up GCC bug number.</p>
<p>The bug is exposed when getting <em>mutable</em> references to string. Necessarily
when the COW is saving us from the OOM we are sharing <em>immutable</em> strings --
otherwise there wouldn&#39;t be any sharing. So once again the idea of immutability
seems important, and related to sharing.</p>
<h4 id="sso-vs-cow">SSO vs. COW</h4>
<p>They both have their place. We know that we&#39;re losing COW sooner rather than
later, but we also know that we have applications that depend on sharing. We have
some thinking and measuring to do...</p>
<p>Note that <code>fbstring</code> kept COW for large strings, though that was deprecated in</p>
<ol>
<li>On the other hand our ship stopper fix was for lots of <em>small</em> strings!</li>
</ol>
<h4 id="intern-strings">Intern strings</h4>
<p>I mentioned above that COW string instances are smaller than SSO instances.
However, sometimes we wanted something even smaller than a pointer. For this
optimization, we built &quot;tables&quot; of de-duplicated strings. Clients use a small
integer &quot;index&quot; for each string.</p>
<p>We paid a cost to construct the table, but when were done we could build dense
&quot;sets&quot; of strings (indices) and manipulate them efficiently.</p>
<p>This is another example of immutability, an example of sharing, and an example
of a special allocator.</p>
<h4 id="heap-fragmentation-and-large-strings">Heap fragmentation and large strings</h4>
<p>TODO: Discuss how large contiguous strings have led to heap fragmentation.</p>
<h4 id="shrink-vs-reserve-">Shrink vs. Reserve.</h4>
<p>TODO: Discuss <code>std::string</code> reserve and <em>optional</em> (i.e. non-portable) shrink to
fit behavior.</p>
<h4 id="encodings">Encodings</h4>
<p>We&#39;ve covered most of our wish list, but we also need to talk about encodings.</p>
<p>One class of serious bugs that we&#39;ve face has been when an application
serializes invalid UTF-8 to the wire. Peer applications correctly reject such
data, leading to loss of communication.</p>
<p>Tracking an individual offending piece of code is usually straightforward. For
example we might find someone copying data directly from a device driver
without first checking the encoding. We can then fix that call site. We can
check encoding before serializing, but that&#39;s often distant from the offending
source of bad data. We have even done work to push checks further up the
&quot;stack&quot;, but since we have &quot;<code>std::string</code> everywhere&quot; we are usually still
several steps away from the root cause when we detect this form of corruption.</p>
<p>Having a <code>utf8_string</code> would help us push checks back to the source of these
errors.</p>
<p>We also need the ability safely mutate UTF-8 along code point boundaries, and
reasonably handle illegal sequences.</p>
<h3 id="formalizing">Formalizing</h3>
<p>After reviewing bugs, our wish list, and other experience I built up a more
formal list of the &quot;attributes&quot; of strings. These next sections will review
these.</p>
<h3 id="data">Data</h3>
<p>Any string implementation has to provide access to the data. This might be a
pointer to an &quot;element&quot; or a C-array of elements.</p>
<pre class="editor-colors lang-c++"><div class="line"><span class="syntax--source syntax--cpp"><span class="syntax--meta syntax--class-struct-block syntax--cpp"><span class="syntax--storage syntax--type syntax--cpp"><span>struct</span></span><span>&nbsp;</span><span class="syntax--entity syntax--name syntax--type syntax--cpp"><span>string_data</span></span><span>&nbsp;</span><span class="syntax--punctuation syntax--section syntax--block syntax--begin syntax--cpp"><span>{</span></span></span></span></div><div class="line"><span class="syntax--source syntax--cpp"><span class="syntax--meta syntax--class-struct-block syntax--cpp"><span>&nbsp;&nbsp;Elem</span><span class="syntax--keyword syntax--operator syntax--c"><span>*</span></span><span>&nbsp;data;</span></span></span></div><div class="line"><span class="syntax--source syntax--cpp"><span class="syntax--meta syntax--class-struct-block syntax--cpp"><span class="syntax--punctuation syntax--section syntax--block syntax--end syntax--cpp"><span>}</span></span></span><span>;</span></span></div></pre>
<h4 id="as-a-function">As a function</h4>
<p>We can think of this as a free function:</p>
<pre class="editor-colors lang-text"><div class="line"><span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>string_get_data(s)&nbsp;-&gt;&nbsp;s::element_type&nbsp;*;</span></span></span></div></pre><h3 id="length">Length</h3>
<p>String implementations are distinguished by how they store length:</p>
<ul>
<li><strong>In the type</strong> - Like <code>array&lt;int, 12&gt;</code>.</li>
</ul>
<pre class="editor-colors lang-c++"><div class="line"><span class="syntax--source syntax--cpp"><span>&nbsp;&nbsp;&nbsp;</span><span class="syntax--storage syntax--type syntax--template syntax--cpp"><span>template</span></span><span class="syntax--keyword syntax--operator syntax--comparison syntax--c"><span>&lt;</span></span><span class="syntax--storage syntax--type syntax--c"><span>int</span></span><span>&nbsp;Length</span><span class="syntax--keyword syntax--operator syntax--comparison syntax--c"><span>&gt;</span></span></span></div><div class="line"><span class="syntax--source syntax--cpp"><span>&nbsp;&nbsp;&nbsp;</span><span class="syntax--meta syntax--class-struct-block syntax--cpp"><span class="syntax--storage syntax--type syntax--cpp"><span>struct</span></span><span>&nbsp;</span><span class="syntax--entity syntax--name syntax--type syntax--cpp"><span>string_data</span></span><span>&nbsp;</span><span class="syntax--punctuation syntax--section syntax--block syntax--begin syntax--cpp"><span>{</span></span></span></span></div><div class="line"><span class="syntax--source syntax--cpp"><span class="syntax--meta syntax--class-struct-block syntax--cpp"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Elem&nbsp;data[Length];</span></span></span></div><div class="line"><span class="syntax--source syntax--cpp"><span class="syntax--meta syntax--class-struct-block syntax--cpp"><span>&nbsp;&nbsp;&nbsp;</span><span class="syntax--punctuation syntax--section syntax--block syntax--end syntax--cpp"><span>}</span></span></span><span>;</span></span></div></pre>
<ul>
<li><strong>Next to the data</strong> - Pascal strings anyone? Or GCC COW.
strings?</li>
</ul>
<pre class="editor-colors lang-c++"><div class="line"><span class="syntax--source syntax--cpp"><span>&nbsp;&nbsp;&nbsp;</span><span class="syntax--meta syntax--class-struct-block syntax--cpp"><span class="syntax--storage syntax--type syntax--cpp"><span>struct</span></span><span>&nbsp;</span><span class="syntax--entity syntax--name syntax--type syntax--cpp"><span>string_data</span></span><span>&nbsp;</span><span class="syntax--punctuation syntax--section syntax--block syntax--begin syntax--cpp"><span>{</span></span></span></span></div><div class="line"><span class="syntax--source syntax--cpp"><span class="syntax--meta syntax--class-struct-block syntax--cpp"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--storage syntax--type syntax--c"><span>int</span></span><span>&nbsp;length;</span></span></span></div><div class="line"><span class="syntax--source syntax--cpp"><span class="syntax--meta syntax--class-struct-block syntax--cpp"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Elem&nbsp;data[];</span></span></span></div><div class="line"><span class="syntax--source syntax--cpp"><span class="syntax--meta syntax--class-struct-block syntax--cpp"><span>&nbsp;&nbsp;&nbsp;</span><span class="syntax--punctuation syntax--section syntax--block syntax--end syntax--cpp"><span>}</span></span></span><span>;</span></span></div></pre>
<ul>
<li><strong>Null termination (Embedded in the data)</strong> - <code>const Elem*</code>.</li>
</ul>
<pre class="editor-colors lang-c++"><div class="line"><span class="syntax--source syntax--cpp"><span>&nbsp;&nbsp;&nbsp;</span><span class="syntax--meta syntax--class-struct-block syntax--cpp"><span class="syntax--storage syntax--type syntax--cpp"><span>struct</span></span><span>&nbsp;</span><span class="syntax--entity syntax--name syntax--type syntax--cpp"><span>string_data</span></span><span>&nbsp;</span><span class="syntax--punctuation syntax--section syntax--block syntax--begin syntax--cpp"><span>{</span></span></span></span></div><div class="line"><span class="syntax--source syntax--cpp"><span class="syntax--meta syntax--class-struct-block syntax--cpp"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Elem&nbsp;data[];</span></span></span></div><div class="line"><span class="syntax--source syntax--cpp"><span class="syntax--meta syntax--class-struct-block syntax--cpp"><span>&nbsp;&nbsp;&nbsp;</span><span class="syntax--punctuation syntax--section syntax--block syntax--end syntax--cpp"><span>}</span></span></span><span>;</span></span></div></pre>
<ul>
<li><strong>Next to a <em>reference</em> to the data</strong> - like <code>string_view</code></li>
</ul>
<pre class="editor-colors lang-c++"><div class="line"><span class="syntax--source syntax--cpp"><span>&nbsp;&nbsp;&nbsp;</span><span class="syntax--meta syntax--class-struct-block syntax--cpp"><span class="syntax--storage syntax--type syntax--cpp"><span>struct</span></span><span>&nbsp;</span><span class="syntax--entity syntax--name syntax--type syntax--cpp"><span>string_data</span></span><span>&nbsp;</span><span class="syntax--punctuation syntax--section syntax--block syntax--begin syntax--cpp"><span>{</span></span></span></span></div><div class="line"><span class="syntax--source syntax--cpp"><span class="syntax--meta syntax--class-struct-block syntax--cpp"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;StringData&nbsp;</span><span class="syntax--keyword syntax--operator syntax--c"><span>*</span></span><span>;</span></span></span></div><div class="line"><span class="syntax--source syntax--cpp"><span class="syntax--meta syntax--class-struct-block syntax--cpp"><span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="syntax--storage syntax--type syntax--c"><span>int</span></span><span>&nbsp;length;</span></span></span></div><div class="line"><span class="syntax--source syntax--cpp"><span class="syntax--meta syntax--class-struct-block syntax--cpp"><span>&nbsp;&nbsp;&nbsp;</span><span class="syntax--punctuation syntax--section syntax--block syntax--end syntax--cpp"><span>}</span></span></span><span>;</span></span></div></pre>
<p>None of these strategies is &quot;the best&quot;. They all have advantages and
disadvantages. For now, let us keep them <em>all</em> in mind.</p>
<h4 id="length-type">Length Type</h4>
<p>I used <code>int</code> above, but we have several choices for the <em>type</em> of the length:</p>
<ul>
<li><code>size_t</code> - Do we really need the full address space?</li>
<li><code>int</code> - The &quot;simplest&quot; / &quot;most obvious&quot; alternative. Also, since we often do
arithmetic with string length signed types are appropriate.</li>
<li><code>ptrdiff_t</code> - If we want &quot;full size&quot; but signed.</li>
<li><code>unsigned int</code> - If we want &quot;reasonable size&quot; but unsigned.</li>
</ul>
<h4 id="empirical-length">Empirical Length</h4>
<p>TODO: Data on string lengths in memory and at rest from
some of our products. (maybe). Add war story about heap fragmentation?</p>
<h4 id="as-a-function">As a function</h4>
<p>So, given any string implementation there will be a function:</p>
<pre class="editor-colors lang-text"><div class="line"><span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>string_get_length(s)&nbsp;-&gt;&nbsp;s::size_type;</span></span></span></div></pre><h3 id="continuity">Continuity</h3>
<p>TODO: Discuss continuity. I would like to limit discussion to contiguous
implementations. Strings <em>do</em> need to inter-operate with &quot;ropes&quot;.</p>
<h3 id="sharing">Sharing</h3>
<p>TODO: Add explanation of how sharing is typically implemented via reference
counting.</p>
<h3 id="encoding">Encoding</h3>
<h4 id="utf-8-and-multi-byte-encodings">UTF-8 and Multi-byte Encodings</h4>
<p><code>std::string</code> completely ignores multi-byte encodings, but UTF-8 rules the real
world and real applications need to work in that world. <code>std::text_view</code> solves
part of the puzzle, but in practice the string type should know about encodings.</p>
<h4 id="illegal-sequences">Illegal sequences</h4>
<p>TODO: Discuss illegal sequences. ASCII and UTF both have them. Correction and
reporting.</p>
<h4 id="ascii">ASCII</h4>
<p>In many contexts, typically symbolic names, ASCII is an invariant.</p>
<p>ASCII is also a proper subset of UTF-8, and we can model that in the type
system:</p>
<pre class="editor-colors lang-c++"><div class="line"><span class="syntax--source syntax--cpp"><span class="syntax--meta syntax--class-struct-block syntax--cpp"><span class="syntax--storage syntax--type syntax--cpp"><span>struct</span></span><span>&nbsp;</span><span class="syntax--entity syntax--name syntax--type syntax--cpp"><span>utf8_string</span></span><span>&nbsp;</span><span class="syntax--punctuation syntax--section syntax--block syntax--begin syntax--cpp"><span>{</span></span></span></span></div><div class="line"><span class="syntax--source syntax--cpp"><span class="syntax--meta syntax--class-struct-block syntax--cpp"><span class="syntax--punctuation syntax--whitespace syntax--comment syntax--leading syntax--cpp"><span>&nbsp;&nbsp;</span></span><span class="syntax--comment syntax--line syntax--double-slash syntax--cpp"><span class="syntax--punctuation syntax--definition syntax--comment syntax--cpp"><span>//</span></span><span>&nbsp;Implicit&nbsp;conversion:</span><span>&nbsp;</span></span></span></span></div><div class="line"><span class="syntax--source syntax--cpp"><span class="syntax--meta syntax--class-struct-block syntax--cpp"><span class="syntax--meta syntax--function syntax--constructor syntax--cpp"><span>&nbsp;&nbsp;</span><span class="syntax--entity syntax--name syntax--function syntax--cpp"><span>utf8_string</span></span><span class="syntax--punctuation syntax--definition syntax--parameters syntax--begin syntax--c"><span>(</span></span><span>ascii_string&nbsp;</span><span class="syntax--storage syntax--modifier syntax--c"><span>const</span></span><span class="syntax--keyword syntax--operator syntax--c"><span>&amp;</span></span><span class="syntax--punctuation syntax--definition syntax--parameters syntax--end syntax--c"><span>)</span></span></span><span>;</span></span></span></div><div class="line"><span class="syntax--source syntax--cpp"><span class="syntax--meta syntax--class-struct-block syntax--cpp"><span>&nbsp;&nbsp;utf8_string</span><span class="syntax--keyword syntax--operator syntax--c"><span>&amp;</span></span><span>&nbsp;</span><span class="syntax--keyword syntax--control syntax--cpp"><span>operator</span></span><span class="syntax--keyword syntax--operator syntax--assignment syntax--c"><span>=</span></span><span>(ascii_string&nbsp;</span><span class="syntax--storage syntax--modifier syntax--c"><span>const</span></span><span class="syntax--keyword syntax--operator syntax--c"><span>&amp;</span></span><span>);.</span></span></span></div><div class="line"><span class="syntax--source syntax--cpp"><span class="syntax--meta syntax--class-struct-block syntax--cpp"><span class="syntax--punctuation syntax--whitespace syntax--comment syntax--leading syntax--cpp"><span>&nbsp;&nbsp;</span></span><span class="syntax--comment syntax--line syntax--double-slash syntax--cpp"><span class="syntax--punctuation syntax--definition syntax--comment syntax--cpp"><span>//</span></span><span>&nbsp;...&nbsp;move,&nbsp;etc.&nbsp;...</span><span>&nbsp;</span></span></span></span></div><div class="line"><span class="syntax--source syntax--cpp"><span class="syntax--meta syntax--class-struct-block syntax--cpp"><span class="syntax--punctuation syntax--section syntax--block syntax--end syntax--cpp"><span>}</span></span></span><span>;</span></span></div><div class="line"><span class="syntax--source syntax--cpp"><span class="syntax--comment syntax--line syntax--double-slash syntax--cpp"><span class="syntax--punctuation syntax--definition syntax--comment syntax--cpp"><span>//</span></span><span>&nbsp;or&nbsp;just&nbsp;slice:</span><span>&nbsp;</span></span></span></div><div class="line"><span class="syntax--source syntax--cpp"><span class="syntax--meta syntax--class-struct-block syntax--cpp"><span class="syntax--storage syntax--type syntax--cpp"><span>struct</span></span><span>&nbsp;</span><span class="syntax--entity syntax--name syntax--type syntax--cpp"><span>utf8_string</span></span><span>&nbsp;:&nbsp;ascii_string&nbsp;</span><span class="syntax--punctuation syntax--section syntax--block syntax--begin syntax--cpp"><span>{</span></span><span>&nbsp;...&nbsp;</span><span class="syntax--punctuation syntax--section syntax--block syntax--end syntax--cpp"><span>}</span></span></span><span>;</span></span></div></pre>
<h4 id="utf-16">UTF-16</h4>
<p>TODO: We want UTF-16 too. Explain.</p>
<h4 id="legacy-encodings">Legacy Encodings</h4>
<p>TODO: Do more research and discuss Non-UTF, legacy encodings. Suggest that we
<em>not</em> consider these, but leave some room for compatibility via separate work?</p>
<p>TODO: More research on Unicode surrogates and UTF-32.</p>
<h4 id="code-points">Code Points</h4>
<p>TODO: Discuss <code>text_view</code> iteration, truncating at code point boundaries,
searching for code points, finding closest code point boundary, etc.</p>
<h4 id="as-a-function">As a function</h4>
<p>TODO: Need &quot;function&quot; form for encoding conversion.</p>
<pre class="editor-colors lang-text"><div class="line"><span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>string_get_encode(s)&nbsp;-&gt;&nbsp;s::encoding_type;</span></span></span></div><div class="line"><span class="syntax--text syntax--plain"><span class="syntax--meta syntax--paragraph syntax--text"><span>encoding_is_multibyte(e)&nbsp;-&gt;&nbsp;e::is_multibyte;</span></span></span></div></pre><h3 id="storage-duration">Storage Duration</h3>
<p>We have the four canonical storage durations:</p>
<ul>
<li><strong>Automatic</strong> - Allocated by the compiler.</li>
<li><strong>Static</strong> - Allocated in program image by the compiler and linker.</li>
<li><strong>Thread</strong> - (Same as static for the purposes of this talk.)</li>
<li><strong>Dynamic</strong> - Allocated dynamically from a runtime library.</li>
</ul>
<h4 id="automatic">Automatic</h4>
<p>Examples:</p>
<ul>
<li>C-array</li>
<li><code>string_view</code>.</li>
<li><code>folly::FixedString</code></li>
<li><code>std::string</code> - sort of - when SSO is in play, or with heap elision?</li>
</ul>
<h4 id="static">Static</h4>
<p>TODO: static. One example is refactoring const string to const char[].</p>
<h4 id="flavors-of-dynamic">Flavors of Dynamic</h4>
<ul>
<li><strong>new/delete</strong> - malloc/free.</li>
<li><strong>Intern String</strong> - special allocator.</li>
<li><strong>Shared</strong> - reference counted.</li>
</ul>
<h4 id="non-type-template-parameters-">Non-type template parameters?</h4>
<p>TODO: summarize current state of making strings as non-type template parameters.</p>
<h3 id="null-ability">Null-ability</h3>
<p>Most string implementations can represent null with &quot;zero cost&quot;. nullptr for
<code>const char*</code>. <code>std::optional</code> could take advantage of a null string. Is there
an opportunity for a language extension for a null char[] literal?</p>
<h3 id="mutability">Mutability</h3>
<p>TODO: More discussion on mutability, sharing and builders. Reducing the cost of
converting from immutable -&gt; builder -&gt; immutable.</p>
<h3 id="summary-table">Summary Table</h3>
<p>TODO: I will build a summary table or chart that compares the attributes
(enumerated above) of existing and potential string implementation types.</p>
<h3 id="implementation">Implementation</h3>
<p>TODO: I will implement &quot;toy&quot; types that demonstrate possible compositions of
attributes and explore how they interact in various use cases.</p>
<p>I will provide examples of:</p>
<ul>
<li>Encoding as part of the type. Conversions to and from encodings including
ASCII, UTF-8 and UTF-16.</li>
<li>Handling of invalid sequences.</li>
<li>Integration with <code>text_view</code>.</li>
<li>Code point safe mutators.</li>
<li>Compatibility and conversion between <code>constexpr string</code>, <code>string</code>, and <code>view</code>.</li>
<li>Representing null.</li>
<li>Shared immutable strings.</li>
<li>Views into shared strings.</li>
<li>Builders for immutable strings.</li>
<li>Shared immutable strings in static storage.</li>
<li>.. and more ...</li>
</ul>
<h3 id="conclusion">Conclusion</h3>
<p>TODO:</p>
<h3 id="q-a">Q &amp; A</h3></body>
</html>
